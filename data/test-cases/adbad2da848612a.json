{"uid":"adbad2da848612a","name":"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1","fullName":"tests.api.test_cached_user_validation.TestCachedUserValidation#test_response_contract_on_success","historyId":"2edf211e33f91f5bb506c9a140929c58","time":{"start":1763156113565,"stop":1763156115599,"duration":2034},"status":"failed","statusMessage":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f9b67e9adc0>()\n +    where <built-in method date of datetime.datetime object at 0x7f9b67e9adc0> = datetime.datetime(2025, 11, 16, 0, 35, 13, 909519).date","statusTrace":"self = <tests.api.test_cached_user_validation.TestCachedUserValidation object at 0x7f9b683a2ff0>\napi = <src.api.safety_pillow_api.SafetyPillowApi object at 0x7f9b67e94800>\n\n    @allure.story(\"Контракт\")\n    @allure.title(\"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1\")\n    def test_response_contract_on_success(self, api: SafetyPillowApi):\n        payload = BASE_VALID.copy()\n        payload[\"birthDate\"] = \"1980-01-01T00:00:00.000\"\n        payload[\"gender\"] = \"M\"\n        payload[\"paymentPeriodicity\"] = \"MONTHLY\"\n        payload[\"term\"] = 10\n        attach_pretty_json(payload, \"Запрос\")\n        resp = api.create_cached_user(payload)\n        assert resp.status_code in (200, 201), _snippet(resp)\n    \n        j = resp.json()\n        assert j.get(\"code\") == 200\n        data = j[\"data\"]\n    \n        assert isinstance(data.get(\"calculation\"), (int, float))\n        assert int(data.get(\"debt\")) == int(payload[\"debt\"])\n    \n        psd_raw = data.get(\"policyStartDate\")\n        psd = _parse_loose_iso(psd_raw) if isinstance(psd_raw, str) else None\n        assert psd is not None, f\"policyStartDate unparsable: {psd_raw}\"\n    \n        expected_date = _policy_start_local_date()\n>       assert psd.date() == expected_date, f\"policyStartDate date={psd.date()} != expected={expected_date}\"\nE       AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nE       assert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\nE        +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f9b67e9adc0>()\nE        +    where <built-in method date of datetime.datetime object at 0x7f9b67e9adc0> = datetime.datetime(2025, 11, 16, 0, 35, 13, 909519).date\n\ntests/api/test_cached_user_validation.py:212: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1763156110886,"stop":1763156110944,"duration":58},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_seed_for_repro","time":{"start":1763156110944,"stop":1763156110944,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"env","time":{"start":1763156110944,"stop":1763156110945,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api","time":{"start":1763156110945,"stop":1763156110945,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"http","time":{"start":1763156110945,"stop":1763156110945,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f9b67e9adc0>()\n +    where <built-in method date of datetime.datetime object at 0x7f9b67e9adc0> = datetime.datetime(2025, 11, 16, 0, 35, 13, 909519).date","statusTrace":"self = <tests.api.test_cached_user_validation.TestCachedUserValidation object at 0x7f9b683a2ff0>\napi = <src.api.safety_pillow_api.SafetyPillowApi object at 0x7f9b67e94800>\n\n    @allure.story(\"Контракт\")\n    @allure.title(\"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1\")\n    def test_response_contract_on_success(self, api: SafetyPillowApi):\n        payload = BASE_VALID.copy()\n        payload[\"birthDate\"] = \"1980-01-01T00:00:00.000\"\n        payload[\"gender\"] = \"M\"\n        payload[\"paymentPeriodicity\"] = \"MONTHLY\"\n        payload[\"term\"] = 10\n        attach_pretty_json(payload, \"Запрос\")\n        resp = api.create_cached_user(payload)\n        assert resp.status_code in (200, 201), _snippet(resp)\n    \n        j = resp.json()\n        assert j.get(\"code\") == 200\n        data = j[\"data\"]\n    \n        assert isinstance(data.get(\"calculation\"), (int, float))\n        assert int(data.get(\"debt\")) == int(payload[\"debt\"])\n    \n        psd_raw = data.get(\"policyStartDate\")\n        psd = _parse_loose_iso(psd_raw) if isinstance(psd_raw, str) else None\n        assert psd is not None, f\"policyStartDate unparsable: {psd_raw}\"\n    \n        expected_date = _policy_start_local_date()\n>       assert psd.date() == expected_date, f\"policyStartDate date={psd.date()} != expected={expected_date}\"\nE       AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nE       assert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\nE        +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f9b67e9adc0>()\nE        +    where <built-in method date of datetime.datetime object at 0x7f9b67e9adc0> = datetime.datetime(2025, 11, 16, 0, 35, 13, 909519).date\n\ntests/api/test_cached_user_validation.py:212: AssertionError","steps":[],"attachments":[{"uid":"8244a60f7ea91afc","name":"Запрос","source":"8244a60f7ea91afc.json","type":"application/json","size":175},{"uid":"62576c520d91e54f","name":"cached/user/index - Request","source":"62576c520d91e54f.json","type":"application/json","size":225},{"uid":"775065d52b72d5e6","name":"cached/user/index - Response","source":"775065d52b72d5e6.json","type":"application/json","size":574},{"uid":"c40a2565441b14cf","name":"cached/user/index - Curl","source":"c40a2565441b14cf.txt","type":"text/plain","size":356}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"story","value":"Контракт"},{"name":"epic","value":"Подушка безопасности"},{"name":"feature","value":"POST /podushka-bezopasnosti/api/v1/cached/user/index — валидация"},{"name":"tag","value":"api"},{"name":"parentSuite","value":"tests.api"},{"name":"suite","value":"test_cached_user_validation"},{"name":"subSuite","value":"TestCachedUserValidation"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"1970-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.api.test_cached_user_validation"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":0,"unknown":0,"total":3},"items":[{"uid":"432f10c0d6d9e87b","status":"failed","statusDetails":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f3144c619b0>()\n +    where <built-in method date of datetime.datetime object at 0x7f3144c619b0> = datetime.datetime(2025, 11, 16, 0, 32, 29, 322856).date","time":{"start":1763155949211,"stop":1763155951631,"duration":2420}},{"uid":"559334572abcb295","status":"failed","statusDetails":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7f0c45483780>()\n +    where <built-in method date of datetime.datetime object at 0x7f0c45483780> = datetime.datetime(2025, 11, 16, 0, 26, 39, 772603).date","time":{"start":1763155599611,"stop":1763155601442,"duration":1831}}]},"tags":["api"]},"source":"adbad2da848612a.json","parameterValues":[]}