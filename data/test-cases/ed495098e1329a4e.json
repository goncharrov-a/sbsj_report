{"uid":"ed495098e1329a4e","name":"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1","fullName":"tests.api.test_cached_user_validation.TestCachedUserValidation#test_response_contract_on_success","historyId":"2edf211e33f91f5bb506c9a140929c58","time":{"start":1763155523471,"stop":1763155525534,"duration":2063},"status":"failed","statusMessage":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7fe19fbb5050>()\n +    where <built-in method date of datetime.datetime object at 0x7fe19fbb5050> = datetime.datetime(2025, 11, 16, 0, 25, 23, 816559).date","statusTrace":"self = <tests.api.test_cached_user_validation.TestCachedUserValidation object at 0x7fe1a01326f0>\napi = <src.api.safety_pillow_api.SafetyPillowApi object at 0x7fe19fbb1a90>\n\n    @allure.story(\"Контракт\")\n    @allure.title(\"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1\")\n    def test_response_contract_on_success(self, api: SafetyPillowApi):\n        payload = BASE_VALID.copy()\n        payload[\"birthDate\"] = \"1980-01-01T00:00:00.000\"\n        payload[\"gender\"] = \"M\"\n        payload[\"paymentPeriodicity\"] = \"MONTHLY\"\n        payload[\"term\"] = 10\n        attach_pretty_json(payload, \"Запрос\")\n        resp = api.create_cached_user(payload)\n        assert resp.status_code in (200, 201), _snippet(resp)\n    \n        j = resp.json()\n        assert j.get(\"code\") == 200\n        data = j[\"data\"]\n    \n        assert isinstance(data.get(\"calculation\"), (int, float))\n        assert int(data.get(\"debt\")) == int(payload[\"debt\"])\n    \n        psd_raw = data.get(\"policyStartDate\")\n        psd = _parse_loose_iso(psd_raw) if isinstance(psd_raw, str) else None\n        assert psd is not None, f\"policyStartDate unparsable: {psd_raw}\"\n    \n        expected_date = _policy_start_local_date()\n>       assert psd.date() == expected_date, f\"policyStartDate date={psd.date()} != expected={expected_date}\"\nE       AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nE       assert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\nE        +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7fe19fbb5050>()\nE        +    where <built-in method date of datetime.datetime object at 0x7fe19fbb5050> = datetime.datetime(2025, 11, 16, 0, 25, 23, 816559).date\n\ntests/api/test_cached_user_validation.py:212: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1763155520892,"stop":1763155520950,"duration":58},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_seed_for_repro","time":{"start":1763155520950,"stop":1763155520950,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"env","time":{"start":1763155520950,"stop":1763155520951,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api","time":{"start":1763155520951,"stop":1763155520951,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"http","time":{"start":1763155520951,"stop":1763155520951,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nassert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\n +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7fe19fbb5050>()\n +    where <built-in method date of datetime.datetime object at 0x7fe19fbb5050> = datetime.datetime(2025, 11, 16, 0, 25, 23, 816559).date","statusTrace":"self = <tests.api.test_cached_user_validation.TestCachedUserValidation object at 0x7fe1a01326f0>\napi = <src.api.safety_pillow_api.SafetyPillowApi object at 0x7fe19fbb1a90>\n\n    @allure.story(\"Контракт\")\n    @allure.title(\"Контракт при 200/201: echo-поля, calculation, policyStartDate = сегодня+1\")\n    def test_response_contract_on_success(self, api: SafetyPillowApi):\n        payload = BASE_VALID.copy()\n        payload[\"birthDate\"] = \"1980-01-01T00:00:00.000\"\n        payload[\"gender\"] = \"M\"\n        payload[\"paymentPeriodicity\"] = \"MONTHLY\"\n        payload[\"term\"] = 10\n        attach_pretty_json(payload, \"Запрос\")\n        resp = api.create_cached_user(payload)\n        assert resp.status_code in (200, 201), _snippet(resp)\n    \n        j = resp.json()\n        assert j.get(\"code\") == 200\n        data = j[\"data\"]\n    \n        assert isinstance(data.get(\"calculation\"), (int, float))\n        assert int(data.get(\"debt\")) == int(payload[\"debt\"])\n    \n        psd_raw = data.get(\"policyStartDate\")\n        psd = _parse_loose_iso(psd_raw) if isinstance(psd_raw, str) else None\n        assert psd is not None, f\"policyStartDate unparsable: {psd_raw}\"\n    \n        expected_date = _policy_start_local_date()\n>       assert psd.date() == expected_date, f\"policyStartDate date={psd.date()} != expected={expected_date}\"\nE       AssertionError: policyStartDate date=2025-11-16 != expected=2025-11-15\nE       assert datetime.date(2025, 11, 16) == datetime.date(2025, 11, 15)\nE        +  where datetime.date(2025, 11, 16) = <built-in method date of datetime.datetime object at 0x7fe19fbb5050>()\nE        +    where <built-in method date of datetime.datetime object at 0x7fe19fbb5050> = datetime.datetime(2025, 11, 16, 0, 25, 23, 816559).date\n\ntests/api/test_cached_user_validation.py:212: AssertionError","steps":[],"attachments":[{"uid":"a10bdec17f4d8c66","name":"Запрос","source":"a10bdec17f4d8c66.json","type":"application/json","size":175},{"uid":"321ca3a51d0108a","name":"cached/user/index - Request","source":"321ca3a51d0108a.json","type":"application/json","size":225},{"uid":"80c460568be3e758","name":"cached/user/index - Response","source":"80c460568be3e758.json","type":"application/json","size":575},{"uid":"2a14481e7ebd52f","name":"cached/user/index - Curl","source":"2a14481e7ebd52f.txt","type":"text/plain","size":356}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"Подушка безопасности"},{"name":"feature","value":"POST /podushka-bezopasnosti/api/v1/cached/user/index — валидация"},{"name":"story","value":"Контракт"},{"name":"tag","value":"api"},{"name":"parentSuite","value":"tests.api"},{"name":"suite","value":"test_cached_user_validation"},{"name":"subSuite","value":"TestCachedUserValidation"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"1961-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.api.test_cached_user_validation"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":["api"]},"source":"ed495098e1329a4e.json","parameterValues":[]}